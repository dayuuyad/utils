pipeline {
    agent any

    stages {


          stage('SonarQube Analysis') {
              steps {
                  script {
                      timeout(time: 1, unit: 'MINUTES') {
                          try {
                              def scannerHome = tool 'sonarqubeScanner'

                              bat """
                                  timeout /t 30 /nobreak > nul 2>&1
                                  call "${scannerHome}\\bin\\sonar-scanner.bat" -v

                                  echo "执行完成!"
                              """
                          } catch (Exception e) {
                              echo "执行超时或出错: ${e.message}"
                              // 强制终止可能的子进程
                              bat "taskkill /f /im java.exe /t 2>nul || echo 没有需要终止的进程"
                          }
                      }
                  }
              }
          }



    }




}
